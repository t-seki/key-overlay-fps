# KeyOverlayFPS - プロジェクト状況

## プロジェクト概要

FPSゲーミング・ストリーミング用のキーボード入力可視化アプリケーション。リアルタイムでキーボード入力を検知し、キーボードレイアウトで表示する。現在は65%キーボードレイアウトに対応済み。

## 技術仕様

- **プラットフォーム**: Windows専用 (WPF)
- **開発言語**: C# .NET 8.0
- **UI フレームワーク**: WPF (Windows Presentation Foundation)
- **キー検出**: GetAsyncKeyState() Windows API
- **更新頻度**: 60FPS (16.67ms間隔)
- **レイアウト**: 65%キーボード (87キー) - 現在実装済み

## 現在の機能

### ✅ 実装済み機能

1. **キーボードレイアウト表示**
   - 65%キーボード準拠 (ESC, 1-0, QWERTY, ASDF, ZXCV, 矢印キー含む)
   - 精巧な位置配置とサイズ調整
   - 87キーの完全対応

2. **リアルタイムキー検出**
   - 全87キーの入力検知
   - 60FPSでのリアルタイム更新
   - 緑色ハイライト表示

3. **Shift修飾キー対応**
   - 数字キー: `1→!`, `2→@`, `3→#`, `4→$`, `5→%`, `6→^`, `7→&`, `8→*`, `9→(`, `0→)`
   - 記号キー: `-→_`, `=→+`, `[→{`, `]→}`, `\→|`, `;→:`, `'→"`, `,→<`, `.→>`, `/→?`

4. **ウィンドウ管理**
   - 常に最前面表示
   - ドラッグ移動対応
   - 右クリックコンテキストメニューによる終了
   - タスクバーからの終了

5. **背景色切り替え**
   - 透明 (デフォルト)
   - クロマキー緑
   - クロマキー青  
   - 黒

6. **ストリーミング対応**
   - 透明背景でのオーバーレイ表示
   - クロマキー背景でのOBS連携

## ファイル構成

```
src/
├── KeyOverlayFPS.csproj     # プロジェクト設定
├── App.xaml                 # アプリケーション設定
├── App.xaml.cs              # アプリケーションコード
├── MainWindow.xaml          # UI レイアウト (87キー定義)
└── MainWindow.xaml.cs       # メインロジック (キー検出・更新)
```

## 主要コンポーネント

### MainWindow.xaml
- Canvas ベースの絶対位置指定レイアウト
- 87個のBorderコントロール (各キー)
- 名前付きTextBlock (動的テキスト更新用)
- コンテキストメニュー（右クリック）

### MainWindow.xaml.cs
- **仮想キーコード定数**: 87キー分のVK_*定数
- **Timer_Tick()**: メインループ (16.67ms間隔)
- **UpdateKeyState()**: 基本キーハイライト更新
- **UpdateKeyStateWithShift()**: Shift対応キー更新
- **GetAsyncKeyState()**: Windows API呼び出し

## 対応キー一覧

### 数字行 (13キー)
ESC, 1-0, -, =, Backspace

### 英字行 (13キー)  
Tab, Q-P, [, ], \

### ホーム行 (12キー)
Caps Lock, A-L, ;, ', Enter

### 下段行 (12キー)
Shift, Z-M, ',', '.', '/', Right Shift, ↑

### 最下段 (10キー)
Ctrl, Win, Alt, Space, Right Alt, Fn, Right Ctrl, ←, ↓, →

## 課題・制限事項

### 解決済み課題
- ✅ Linux互換性問題 → Windows専用として確定
- ✅ 透明背景でのマウスイベント問題 → 半透明背景で解決
- ✅ クロマキー背景でのクラッシュ → AllowsTransparency静的設定で解決
- ✅ 不均一なボーダー表示 → 全キー BorderThickness="1" で統一
- ✅ 不完全なキー検出 → 全87キー対応完了
- ✅ Shift表示未対応 → 全記号キー対応完了

### 現在の制限事項
- **Windows専用**: WPF依存のためLinux/Mac非対応
- **管理者権限**: 一部のキー検出で必要な場合あり
- **Fnキー**: ハードウェア依存のため検出不可
- **レイアウト制限**: 現在は65%英語キーボードレイアウトのみ対応

## 残タスク

### 🟢 現在のタスク状況
**すべての主要機能が実装完了済み**

### 🔵 潜在的な改善項目 (優先度低)
1. **設定の永続化**
   - 背景色設定の保存
   - ウィンドウ位置の記憶

2. **カスタマイズ機能**
   - ハイライト色の変更
   - キーサイズの調整
   - フォントの変更

3. **パフォーマンス最適化**
   - CPU使用率の最適化
   - メモリ使用量の削減

### 🟡 将来的な拡張計画 (優先度中)
1. **複数キーボードレイアウト対応**
   - 60%キーボードレイアウト
   - フルサイズキーボード（テンキー付き）
   - 75%キーボードレイアウト
   - TKL（テンキーレス）レイアウト

2. **多言語キーボード対応**
   - 日本語キーボード配列
   - 各国語キーボード配列
   - レイアウト切り替え機能

3. **UI改善**
   - 不要な閉じるボタンの削除
   - レイアウト選択メニューの追加
   - 言語選択機能の追加

## ビルド・実行手順

```bash
# プロジェクトディレクトリに移動
cd /home/tseki/dev/key-overlay-fps/src

# ビルド実行
dotnet build

# アプリケーション実行
dotnet run
```

## 動作確認済み環境

- **OS**: Windows 10/11
- **.NET**: 8.0
- **解像度**: 1920x1080 (その他未確認)

## 最終更新

**日付**: 2025-06-26  
**バージョン**: 1.0.0  
**状態**: 全機能実装完了